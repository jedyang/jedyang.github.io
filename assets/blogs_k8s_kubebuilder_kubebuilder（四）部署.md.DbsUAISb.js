import{_ as s,c as a,o as e,a2 as n}from"./chunks/framework.DukRYrIy.js";const p="/assets/image-20240314160120867.BKa_XDfW.png",l="/assets/image-20240314160619545.u82nGfIe.png",i="/assets/image-20240314160740364.D9O3YKUs.png",t="/assets/image-20240314162601021.lKw-aS6P.png",q=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"blogs/k8s/kubebuilder/kubebuilder（四）部署.md","filePath":"blogs/k8s/kubebuilder/kubebuilder（四）部署.md","lastUpdated":1711088688000}'),r={name:"blogs/k8s/kubebuilder/kubebuilder（四）部署.md"},o=n(`<h2 id="kubebuilder-四-部署" tabindex="-1">kubebuilder（四）部署 <a class="header-anchor" href="#kubebuilder-四-部署" aria-label="Permalink to &quot;kubebuilder（四）部署&quot;">​</a></h2><h3 id="将crd部署到k8s" tabindex="-1">将crd部署到k8s <a class="header-anchor" href="#将crd部署到k8s" aria-label="Permalink to &quot;将crd部署到k8s&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>make install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>日志：</p><blockquote><p>kustomize build config/crd | kubectl apply -f - customresourcedefinition.apiextensions.k8s.io/demoes.tutorial.demo.com created</p></blockquote><p>查看下</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>[root@paas-m-k8s-master-1 demo-operator]# kubectl api-resources | grep demo</span></span>
<span class="line"><span>demoes                                              tutorial.demo.com                  true         Demo</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>确实有了，不错哦。</p><h3 id="编译运行controller" tabindex="-1">编译运行controller <a class="header-anchor" href="#编译运行controller" aria-label="Permalink to &quot;编译运行controller&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>make run</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>保持窗口开启</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>。。。日志如下</span></span>
<span class="line"><span>go run ./main.go</span></span>
<span class="line"><span>I0314 14:37:11.802311   20314 request.go:665] Waited for 1.037997549s due to client-side throttling, not priority and fairness, request: GET:https://apiserver.cluster.local:6443/apis/rbac.istio.io/v1alpha1?timeout=32s</span></span>
<span class="line"><span>2024-03-14T14:37:13.055+0800    INFO    controller-runtime.metrics      metrics server is starting to listen    {&quot;addr&quot;: &quot;:8080&quot;}</span></span>
<span class="line"><span>2024-03-14T14:37:13.055+0800    INFO    setup   starting manager</span></span>
<span class="line"><span>2024-03-14T14:37:13.055+0800    INFO    starting metrics server {&quot;path&quot;: &quot;/metrics&quot;}</span></span>
<span class="line"><span>2024-03-14T14:37:13.055+0800    INFO    controller.demo Starting EventSource    {&quot;reconciler group&quot;: &quot;tutorial.demo.com&quot;, &quot;reconciler kind&quot;: &quot;Demo&quot;, &quot;source&quot;: &quot;kind source: /, Kind=&quot;}</span></span>
<span class="line"><span>2024-03-14T14:37:13.055+0800    INFO    controller.demo Starting Controller     {&quot;reconciler group&quot;: &quot;tutorial.demo.com&quot;, &quot;reconciler kind&quot;: &quot;Demo&quot;}</span></span>
<span class="line"><span>2024-03-14T14:37:13.258+0800    INFO    controller.demo Starting workers        {&quot;reconciler group&quot;: &quot;tutorial.demo.com&quot;, &quot;reconciler kind&quot;: &quot;Demo&quot;, &quot;worker count&quot;: 1}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="创建一个crd实例" tabindex="-1">创建一个crd实例 <a class="header-anchor" href="#创建一个crd实例" aria-label="Permalink to &quot;创建一个crd实例&quot;">​</a></h3><p>在samples目录下有一个默认的资源描述文件tutorial_v1_demo.yaml</p><p>我们可以使用进行部署测试</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>apiVersion: tutorial.demo.com/v1</span></span>
<span class="line"><span>kind: Demo</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  namespace: demo</span></span>
<span class="line"><span>  name: demo-sample</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  # TODO(user): Add fields here</span></span>
<span class="line"><span>  image: nginx:1.22</span></span>
<span class="line"><span>  svcName: demo-ng</span></span>
<span class="line"><span>  replicas: 3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>现在还没有我们自定义的demo crd实例，demo nameSpace下也没有任何pod</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span># kubectl -n demo get demo</span></span>
<span class="line"><span>No resources found in default namespace.</span></span>
<span class="line"><span># kubectl -n demo get pod</span></span>
<span class="line"><span>No resources found in demo namespace.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们apply一下这个demo crd</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span># kubectl apply -f config/samples/tutorial_v1_demo.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看自定义资源</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>#  kubectl get demo -n demo</span></span>
<span class="line"><span>NAME          AGE</span></span>
<span class="line"><span>demo-sample   12s</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="controller的日志" tabindex="-1">controller的日志 <a class="header-anchor" href="#controller的日志" aria-label="Permalink to &quot;controller的日志&quot;">​</a></h3><p><img src="`+p+`" alt="image-20240314160120867"></p><h3 id="查看资源" tabindex="-1">查看资源 <a class="header-anchor" href="#查看资源" aria-label="Permalink to &quot;查看资源&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span># kubectl -n demo get pod</span></span>
<span class="line"><span>NAME                       READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>demo-ng-6df8f7c68f-4mg9n   1/1     Running   0          4m33s</span></span>
<span class="line"><span>demo-ng-6df8f7c68f-699bv   1/1     Running   0          4m33s</span></span>
<span class="line"><span>demo-ng-6df8f7c68f-n6zkc   1/1     Running   0          4m33s</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>看到3个pod都创建出来了</p><p>验证通过patch修改podNum，来增减pod的数量</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>kubectl -n demo patch demo demo-sample --type merge --patch &#39;{&quot;spec&quot;: {&quot;replicas&quot;: 5}}&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="`+l+'" alt="image-20240314160619545"></p><p>自动加到了5个</p><p>减一下</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>kubectl -n demo patch demo demo-sample --type merge --patch &#39;{&quot;spec&quot;: {&quot;replicas&quot;: 2}}&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="'+i+'" alt="image-20240314160740364"></p><p>controller中也会看到对应的日志</p><p><img src="'+t+'" alt="image-20240314162601021"></p>',36),c=[o];function d(u,m,b,h,g,v){return e(),a("div",null,c)}const _=s(r,[["render",d]]);export{q as __pageData,_ as default};
